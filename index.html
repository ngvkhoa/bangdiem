<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng Điểm</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f4f4f4;
            color: #333;
        }

        input[type="text"] {
            width: 100%;
            border: none;
            text-align: center;
            background-color: #f9f9f9;
        }

        input[type="text"]:focus {
            outline: none;
            background-color: #e8f0fe;
        }

        tfoot {
            background-color: #f4f4f4;
            font-weight: bold;
        }

        .award {
            font-weight: bold;
            color: #333;
        }

        .clear-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #f44336;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        .clear-btn:hover {
            background-color: #d32f2f;
        }
    </style>
</head>
<body>
    <h1>Bảng Điểm</h1>
    <table>
        <thead>
            <tr>
                <th>Môn học</th>
                <th>TX1</th>
                <th>TX2</th>
                <th>TX3</th>
                <th>TX4</th>
                <th>TX5</th>
                <th>Giữa kỳ (x2)</th>
                <th>Cuối kỳ (x3)</th>
                <th>Trung bình</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Toán</td>
                <td><input type="text" class="score" data-subject="Toán" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Toán" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Toán" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Toán" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Toán" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Toán" data-weight="2"></td>
                <td><input type="text" class="score" data-subject="Toán" data-weight="3"></td>
                <td class="average">0.0</td>
            </tr>
            <tr>
                <td>Vật lý</td>
                <td><input type="text" class="score" data-subject="Vật lý" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Vật lý" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Vật lý" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Vật lý" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Vật lý" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Vật lý" data-weight="2"></td>
                <td><input type="text" class="score" data-subject="Vật lý" data-weight="3"></td>
                <td class="average">0.0</td>
            </tr>
            <tr>
                <td>Hóa học</td>
                <td><input type="text" class="score" data-subject="Hóa học" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Hóa học" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Hóa học" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Hóa học" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Hóa học" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Hóa học" data-weight="2"></td>
                <td><input type="text" class="score" data-subject="Hóa học" data-weight="3"></td>
                <td class="average">0.0</td>
            </tr>
            <tr>
                <td>Sinh học</td>
                <td><input type="text" class="score" data-subject="Sinh học" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Sinh học" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Sinh học" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Sinh học" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Sinh học" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Sinh học" data-weight="2"></td>
                <td><input type="text" class="score" data-subject="Sinh học" data-weight="3"></td>
                <td class="average">0.0</td>
            </tr>
            <tr>
                <td>Ngữ văn</td>
                <td><input type="text" class="score" data-subject="Ngữ văn" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Ngữ văn" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Ngữ văn" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Ngữ văn" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Ngữ văn" data-weight="1"></td>                
                <td><input type="text" class="score" data-subject="Ngữ văn" data-weight="2"></td>
                <td><input type="text" class="score" data-subject="Ngữ văn" data-weight="3"></td>
                <td class="average">0.0</td>
            </tr>
            <tr>
                <td>Lịch sử</td>
                <td><input type="text" class="score" data-subject="Lịch sử" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Lịch sử" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Lịch sử" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Lịch sử" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Ngữ văn" data-weight="1"></td>     
                <td><input type="text" class="score" data-subject="Lịch sử" data-weight="2"></td>
                <td><input type="text" class="score" data-subject="Lịch sử" data-weight="3"></td>
                <td class="average">0.0</td>
            </tr>
            <tr>
                <td>Tiếng Anh</td>
                <td><input type="text" class="score" data-subject="Tiếng Anh" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Tiếng Anh" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Tiếng Anh" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Tiếng Anh" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Tiếng Anh" data-weight="1"></td>                
                <td><input type="text" class="score" data-subject="Tiếng Anh" data-weight="2"></td>
                <td><input type="text" class="score" data-subject="Tiếng Anh" data-weight="3"></td>
                <td class="average">0.0</td>
            </tr>
            <tr>
                <td>Công nghệ</td>
                <td><input type="text" class="score" data-subject="Công nghệ" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Công nghệ" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Công nghệ" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Công nghệ" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Công nghệ" data-weight="1"></td>  
                <td><input type="text" class="score" data-subject="Công nghệ" data-weight="2"></td>
                <td><input type="text" class="score" data-subject="Công nghệ" data-weight="3"></td>
                <td class="average">0.0</td>
            </tr>
            <tr>
                <td>ANQP</td>
                <td><input type="text" class="score" data-subject="Giáo dục công dân" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Giáo dục công dân" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Giáo dục công dân" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Giáo dục công dân" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Giáo dục công dân" data-weight="1"></td>
                <td><input type="text" class="score" data-subject="Giáo dục công dân" data-weight="2"></td>
                <td><input type="text" class="score" data-subject="Giáo dục công dân" data-weight="3"></td>
                <td class="average">0.0</td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="7">Điểm tổng trung bình</td>
                <td id="overall-average">0.0</td>
            </tr>
            <tr>
                <td colspan="7">Danh hiệu</td>
                <td id="award" class="award">Khá</td>
            </tr>
        </tfoot>
    </table>

    <button class="clear-btn" onclick="clearAll()">Xóa tất cả</button>

    <script>
        // Lưu dữ liệu vào localStorage
        function saveData() {
            const scores = {};
            document.querySelectorAll('.score').forEach(input => {
                const subject = input.dataset.subject;
                const index = Array.from(input.closest('tr').children).indexOf(input.closest('td'));
                if (!scores[subject]) {
                    scores[subject] = [];
                }
                scores[subject][index] = input.value;
            });
            localStorage.setItem('scores', JSON.stringify(scores));
        }

        // Lấy dữ liệu từ localStorage
        function loadData() {
            const scores = JSON.parse(localStorage.getItem('scores')) || {};
            document.querySelectorAll('.score').forEach(input => {
                const subject = input.dataset.subject;
                const index = Array.from(input.closest('tr').children).indexOf(input.closest('td'));
                const value = scores[subject] ? scores[subject][index] : '';
                input.value = value;
            });
            calculateOverallAverage();
        }

        // Tính điểm trung bình cho mỗi môn
        function calculateRowAverage(row) {
            const inputs = row.querySelectorAll('.score');
            let total = 0;
            let weightSum = 0;

            inputs.forEach(input => {
                const value = parseFloat(input.value);
                const weight = parseInt(input.dataset.weight);

                if (!isNaN(value)) {
                    total += value * weight;
                    weightSum += weight;
                }
            });

            const averageCell = row.querySelector('.average');
            const average = weightSum > 0 ? (total / weightSum) : 0;
            averageCell.textContent = average.toFixed(2);

            return average;
        }

        // Tính điểm tổng trung bình và danh hiệu
        function calculateOverallAverage() {
            const rows = document.querySelectorAll('tbody tr');
            let totalAverage = 0;
            let subjectCount = 0;
            let excellentCount = 0;
            let goodCount = 0;
            let allAbove65 = true;

            rows.forEach(row => {
                const average = calculateRowAverage(row);
                if (average <= 6.5) {
                    allAbove65 = false;
                }
                if (average >= 9) excellentCount++;
                else if (average >= 8) goodCount++;
                if (average > 0) {
                    totalAverage += average;
                    subjectCount++;
                }
            });

            const overallAverage = subjectCount > 0 ? (totalAverage / subjectCount) : 0;
            document.getElementById('overall-average').textContent = overallAverage.toFixed(2);

            // Xác định danh hiệu
            let award = 'Khá';
            if (allAbove65) {
                if (excellentCount >= 6) {
                    award = 'Xuất sắc';
                } else if (goodCount >= 6) {
                    award = 'Giỏi';
                }
            }

            document.getElementById('award').textContent = award;

            // Lưu lại dữ liệu sau khi tính toán
            saveData();
        }

        // Xóa tất cả dữ liệu
        function clearAll() {
            localStorage.removeItem('scores');
            document.querySelectorAll('.score').forEach(input => {
                input.value = '';
            });
            calculateOverallAverage();
        }

        // Lắng nghe sự kiện nhập liệu
        document.querySelectorAll('.score').forEach(input => {
            input.addEventListener('input', () => {
                calculateOverallAverage();
            });
        });

        // Khi trang được tải lại, lấy dữ liệu đã lưu
        window.onload = loadData;
    </script>
</body>
</html>
